@page "/play-quiz/{QuizId}"
@using QuizApp.Services
@using QuizApp.Components
@inject QuizService QuizService
@rendermode InteractiveServer

<div class="container mt-4">
    @if (isLoading) {
        <div class="text-center"><div class="spinner-border"></div></div>
    }
    else if (questions == null || !questions.Any()) {
        <div class="alert alert-warning">This quiz has no questions!</div>
    }
    else {
        @if (!hasStarted) {
            @* --- LOBBY SCREEN --- *@
            <div class="card shadow-sm mx-auto text-center p-5" style="max-width: 600px;">
                <h1 class="mb-3">@quizTitle</h1>
                <p class="text-muted mb-4">@questions.Count Questions</p>

                <div class="form-check form-switch d-inline-block text-start bg-light p-3 rounded mb-4">
                    <input class="form-check-input" type="checkbox" id="feedbackToggle" @bind="showFeedback">
                    <label class="form-check-label ms-2" for="feedbackToggle">
                        <strong>Show Instant Feedback?</strong><br />
                    </label>
                </div>

                <div>
                    <button class="btn btn-primary btn-lg w-50" @onclick="() => hasStarted = true">
                        Start Quiz ▶
                    </button>
                </div>
            </div>
        }
        else {
            <QuizRunner Questions="questions" ShowInstantFeedback="showFeedback" />
        }
    }
</div>

@code {
    [Parameter] public string QuizId { get; set; }

    private bool showFeedback = true;
    private bool hasStarted = false;

    private List<Question> questions;
    private string quizTitle;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync () {
        var result = await QuizService.GetQuizWithQuestionsAsync(QuizId);
        if (result != null) {
            quizTitle = result.Quiz.Title;
            questions = result.Questions;
        }
        isLoading = false;
    }
}